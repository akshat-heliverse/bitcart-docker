# NOTE: THIS FILE IS GENERATED VIA ./build.sh
# DO NOT EDIT THIS FILE DIRECTLY UNLESS REQUESTED
# Use BITCART_ADDITIONAL_COMPONENTS and set BITCARTGEN_DOCKER_IMAGE to bitcart/docker-compose-generator:local
# to load custom .yml components you add in generator/docker-components directory
services:
  admin:
    restart: unless-stopped
    image: bitcart/bitcart-admin:stable
    expose:
    - '4000'
    command: yarn start
    environment:
      BITCART_ADMIN_LOG_FILE: bitcart.log
      BITCART_ADMIN_API_URL: ${BITCART_ADMIN_API_URL}
      VIRTUAL_NETWORK: nginx-proxy
      VIRTUAL_PORT: 4000
      VIRTUAL_HOST: ${BITCART_ADMIN_HOST}
      VIRTUAL_HOST_NAME: bitcart-admin
      LETSENCRYPT_HOST: ${BITCART_ADMIN_HOST}
      LETSENCRYPT_EMAIL: ${BITCART_LETSENCRYPT_EMAIL}
      BITCART_ADMIN_ROOTPATH: ${BITCART_ADMIN_ROOTPATH:-/}
      BITCART_STORE_HOST: ${BITCART_STORE_HOST}
      BITCART_STORE_ROOTPATH: ${BITCART_STORE_ROOTPATH:-/}
      HIDDENSERVICE_NAME: Bitcart-Admin-Panel
      BITCART_ADMIN_SOCKS_PROXY: socks5h://tor:9050
      HIDDENSERVICE_REVERSEPROXY: compose-nginx-1
    volumes:
    - tor_servicesdir:/var/lib/tor/hidden_services
    links:
    - backend
  backend:
    depends_on:
    - bitcoin
    - database
    - redis
    links:
    - bitcoin
    - database
    - redis
    restart: unless-stopped
    image: bitcart/bitcart:stable
    command: bash -c "alembic upgrade head && gunicorn -c gunicorn.conf.py \"main:configure_production_app()\""
    environment:
      BITCART_ENV: production
      LOG_FILE: bitcart.log
      BITCART_DATADIR: /datadir
      BITCART_BACKUPS_DIR: /backups
      BITCART_VOLUMES: /datadir /backups /plugins
      DB_PORT: 5432
      DB_HOST: database
      VIRTUAL_NETWORK: nginx-proxy
      VIRTUAL_PORT: 8000
      VIRTUAL_HOST: ${BITCART_HOST}
      VIRTUAL_HOST_NAME: bitcart-backend
      LETSENCRYPT_HOST: ${BITCART_HOST}
      LETSENCRYPT_EMAIL: ${BITCART_LETSENCRYPT_EMAIL}
      BITCART_CRYPTOS: ${BITCART_CRYPTOS:-btc}
      BTC_NETWORK: ${BTC_NETWORK:-mainnet}
      BTC_LIGHTNING: ${BTC_LIGHTNING:-false}
      BCH_NETWORK: ${BCH_NETWORK:-mainnet}
      ETH_NETWORK: ${ETH_NETWORK:-mainnet}
      BNB_NETWORK: ${BNB_NETWORK:-mainnet}
      MATIC_NETWORK: ${MATIC_NETWORK:-mainnet}
      TRX_NETWORK: ${TRX_NETWORK:-mainnet}
      XRG_NETWORK: ${XRG_NETWORK:-mainnet}
      LTC_NETWORK: ${LTC_NETWORK:-mainnet}
      LTC_LIGHTNING: ${LTC_LIGHTNING:-false}
      GRS_NETWORK: ${GRS_NETWORK:-mainnet}
      GRS_LIGHTNING: ${GRS_LIGHTNING:-false}
      XMR_NETWORK: ${XMR_NETWORK:-mainnet}
      UPDATE_URL: ${BITCART_UPDATE_URL:-https://api.bitcart.ai/updates/latest}
      BITCART_BACKEND_ROOTPATH: ${BITCART_BACKEND_ROOTPATH:-}
      SSH_CONNECTION: root@host.docker.internal:22
      SSH_KEY_FILE: ${BITCART_SSH_KEY_FILE}
      SSH_AUTHORIZED_KEYS: ${BITCART_SSH_AUTHORIZED_KEYS}
      BASH_PROFILE_SCRIPT: ${BASH_PROFILE_SCRIPT}
      BITCART_BACKEND_PLUGINS_DIR: /plugins/backend
      BITCART_ADMIN_PLUGINS_DIR: /plugins/admin
      BITCART_STORE_PLUGINS_DIR: /plugins/store
      BITCART_DAEMON_PLUGINS_DIR: /plugins/daemon
      BITCART_DOCKER_PLUGINS_DIR: /plugins/docker
      BITCART_HOST: ${BITCART_HOST}
      BITCART_ADMIN_HOST: ${BITCART_ADMIN_HOST}
      BITCART_ADMIN_ROOTPATH: ${BITCART_ADMIN_ROOTPATH:-/}
      BITCART_REVERSEPROXY: ${BITCART_REVERSEPROXY:-nginx-https}
      BITCART_HTTPS_ENABLED: ${BITCART_HTTPS_ENABLED:-false}
      SENTRY_DSN: ${BITCART_SENTRY_DSN:-}
      BITCART_API_WORKERS: ${BITCART_API_WORKERS}
      BITCART_PROMETHEUS_METRICS_ENABLED: ${BITCART_PROMETHEUS_METRICS_ENABLED:-false}
      HIDDENSERVICE_NAME: Bitcart-Merchants-API
      TORRC_FILE: /usr/local/etc/tor/torrc-2
      HIDDENSERVICE_REVERSEPROXY: compose-nginx-1
    extra_hosts:
    - host.docker.internal:host-gateway
    expose:
    - '8000'
    volumes:
    - bitcart_datadir:/datadir
    - backup_datadir:/backups
    - ./plugins/backend:/plugins/backend
    - ./plugins/admin:/plugins/admin
    - ./plugins/store:/plugins/store
    - ./plugins/daemon:/plugins/daemon
    - ./plugins/docker:/plugins/docker
    # SSH authorized_keys mount removed for Coolify compatibility (variable substitution not allowed)
    # - /root/.ssh/authorized_keys:${BITCART_SSH_AUTHORIZED_KEYS}
    - tor_servicesdir:/var/lib/tor/hidden_services
    - tor_torrcdir:/usr/local/etc/tor/
  bitcoin:
    restart: unless-stopped
    image: bitcart/bitcart-btc:stable
    environment:
      BTC_NETWORK: ${BTC_NETWORK:-mainnet}
      BTC_LIGHTNING: ${BTC_LIGHTNING:-false}
      BTC_LIGHTNING_GOSSIP: ${BTC_LIGHTNING_GOSSIP:-false}
      BTC_DEBUG: ${BTC_DEBUG:-false}
      BTC_PROXY_URL: socks5://tor:9050
    expose:
    - '5000'
    volumes:
    - bitcoin_datadir:/data
  database:
    restart: unless-stopped
    image: pgautoupgrade/pgautoupgrade:17-alpine
    command:
    - -c
    - random_page_cost=1.0
    environment:
      POSTGRES_USER: postgres
      POSTGRES_DB: bitcart
      POSTGRES_HOST_AUTH_METHOD: trust
    volumes:
    - dbdata:/var/lib/postgresql/data
    expose:
    - '5432'
  nginx:
    restart: unless-stopped
    image: nginx:stable
    ports:
    - ${REVERSEPROXY_HTTP_PORT:-80}:80
    - ${REVERSEPROXY_HTTPS_PORT:-443}:443
    volumes:
    - nginx_conf:/etc/nginx/conf.d
    - nginx_vhost:/etc/nginx/vhost.d
    - nginx_html:/usr/share/nginx/html
    - nginx_certs:/etc/nginx/certs:ro
    - tor_servicesdir:/var/lib/tor/hidden_services
  nginx-gen:
    restart: unless-stopped
    image: bitcart/docker-gen:0.9.2
    environment:
      DEFAULT_HOST: ${REVERSEPROXY_DEFAULT_HOST:-none}
    volumes:
    - /var/run/docker.sock:/tmp/docker.sock:ro
    - ./nginx.tmpl:/etc/docker-gen/templates/nginx.tmpl:ro
    - nginx_conf:/etc/nginx/conf.d
    - nginx_vhost:/etc/nginx/vhost.d
    - nginx_html:/usr/share/nginx/html
    - nginx_certs:/etc/nginx/certs:ro
    - tor_servicesdir:/var/lib/tor/hidden_services
    entrypoint: /usr/local/bin/docker-gen -filter-network compose_default -notify-sighup
      compose-nginx-1 -watch -wait 5s:30s /etc/docker-gen/templates/nginx.tmpl /etc/nginx/conf.d/default.conf
    links:
    - nginx
  nginx-https:
    restart: unless-stopped
    image: nginxproxy/acme-companion:2.1
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock:ro
    - nginx_conf:/etc/nginx/conf.d
    - nginx_vhost:/etc/nginx/vhost.d
    - nginx_html:/usr/share/nginx/html
    - acme:/etc/acme.sh
    - nginx_certs:/etc/nginx/certs:rw
    environment:
      NGINX_DOCKER_GEN_CONTAINER: compose-nginx-gen-1
      NGINX_PROXY_CONTAINER: compose-nginx-1
      ACME_CA_URI: ${ACME_CA_URI:-https://acme-v02.api.letsencrypt.org/directory}
    links:
    - nginx-gen
  redis:
    restart: unless-stopped
    image: redis:alpine
    expose:
    - '6379'
  store:
    restart: unless-stopped
    image: bitcart/bitcart-store:stable
    expose:
    - '3000'
    command: yarn start
    environment:
      BITCART_STORE_API_URL: ${BITCART_STORE_API_URL}
      VIRTUAL_NETWORK: nginx-proxy
      VIRTUAL_PORT: 3000
      VIRTUAL_HOST: ${BITCART_STORE_HOST}
      VIRTUAL_HOST_NAME: bitcart-store
      LETSENCRYPT_HOST: ${BITCART_STORE_HOST}
      LETSENCRYPT_EMAIL: ${BITCART_LETSENCRYPT_EMAIL}
      BITCART_STORE_ROOTPATH: ${BITCART_STORE_ROOTPATH:-/}
      BITCART_ADMIN_HOST: ${BITCART_ADMIN_HOST}
      BITCART_ADMIN_ROOTPATH: ${BITCART_ADMIN_ROOTPATH:-/}
      HIDDENSERVICE_NAME: Bitcart-Store
      BITCART_STORE_SOCKS_PROXY: socks5h://tor:9050
      HIDDENSERVICE_REVERSEPROXY: compose-nginx-1
    volumes:
    - tor_servicesdir:/var/lib/tor/hidden_services
    links:
    - backend
  tor:
    restart: unless-stopped
    image: bitcart/tor:0.4.7.13
    environment:
      TOR_PASSWORD: bitcart
      TOR_ADDITIONAL_CONFIG: /usr/local/etc/tor/torrc-2
      TOR_EXTRA_ARGS: 'CookieAuthentication 1

        DataDirectoryGroupReadable 1

        '
    expose:
    - '9050'
    - '9051'
    volumes:
    - tor_datadir:/home/tor/.tor
    - tor_torrcdir:/usr/local/etc/tor
    - tor_servicesdir:/var/lib/tor/hidden_services
  tor-gen:
    restart: unless-stopped
    image: bitcart/docker-gen:0.9.2
    volumes:
    - /var/run/docker.sock:/tmp/docker.sock:ro
    - ./torrc.tmpl:/etc/docker-gen/templates/torrc.tmpl:ro
    - tor_torrcdir:/usr/local/etc/tor
    entrypoint: /usr/local/bin/docker-gen -filter-network compose_default -notify-sighup
      compose-tor-1 -watch -wait 5s:30s /etc/docker-gen/templates/torrc.tmpl /usr/local/etc/tor/torrc-2
    links:
    - tor
  worker:
    depends_on:
    - backend
    links:
    - backend
    restart: unless-stopped
    image: bitcart/bitcart:stable
    command: python3 worker.py
    environment:
      BITCART_ENV: production
      LOG_FILE: bitcart.log
      BITCART_DATADIR: /datadir
      BITCART_BACKUPS_DIR: /backups
      BITCART_VOLUMES: /datadir /backups /plugins
      BITCART_CRYPTOS: ${BITCART_CRYPTOS:-btc}
      BTC_NETWORK: ${BTC_NETWORK:-mainnet}
      BTC_LIGHTNING: ${BTC_LIGHTNING:-false}
      BCH_NETWORK: ${BCH_NETWORK:-mainnet}
      ETH_NETWORK: ${ETH_NETWORK:-mainnet}
      BNB_NETWORK: ${BNB_NETWORK:-mainnet}
      MATIC_NETWORK: ${MATIC_NETWORK:-mainnet}
      TRX_NETWORK: ${TRX_NETWORK:-mainnet}
      XRG_NETWORK: ${XRG_NETWORK:-mainnet}
      LTC_NETWORK: ${LTC_NETWORK:-mainnet}
      LTC_LIGHTNING: ${LTC_LIGHTNING:-false}
      GRS_NETWORK: ${GRS_NETWORK:-mainnet}
      GRS_LIGHTNING: ${GRS_LIGHTNING:-false}
      XMR_NETWORK: ${XMR_NETWORK:-mainnet}
      UPDATE_URL: ${BITCART_UPDATE_URL:-https://api.bitcart.ai/updates/latest}
      SSH_CONNECTION: root@host.docker.internal:22
      SSH_KEY_FILE: ${BITCART_SSH_KEY_FILE}
      SSH_AUTHORIZED_KEYS: ${BITCART_SSH_AUTHORIZED_KEYS}
      BASH_PROFILE_SCRIPT: ${BASH_PROFILE_SCRIPT}
      BITCART_BACKEND_PLUGINS_DIR: /plugins/backend
      BITCART_ADMIN_PLUGINS_DIR: /plugins/admin
      BITCART_STORE_PLUGINS_DIR: /plugins/store
      BITCART_DAEMON_PLUGINS_DIR: /plugins/daemon
      BITCART_DOCKER_PLUGINS_DIR: /plugins/docker
      BITCART_HOST: ${BITCART_HOST}
      BITCART_ADMIN_HOST: ${BITCART_ADMIN_HOST}
      BITCART_ADMIN_ROOTPATH: ${BITCART_ADMIN_ROOTPATH:-/}
      BITCART_REVERSEPROXY: ${BITCART_REVERSEPROXY:-nginx-https}
      BITCART_HTTPS_ENABLED: ${BITCART_HTTPS_ENABLED:-false}
      SENTRY_DSN: ${BITCART_SENTRY_DSN:-}
      BITCART_PROMETHEUS_METRICS_ENABLED: ${BITCART_PROMETHEUS_METRICS_ENABLED:-false}
      TORRC_FILE: /usr/local/etc/tor/torrc-2
    extra_hosts:
    - host.docker.internal:host-gateway
    expose:
    - '9020'
    volumes:
    - bitcart_datadir:/datadir
    - backup_datadir:/backups
    - ./plugins/backend:/plugins/backend
    - ./plugins/admin:/plugins/admin
    - ./plugins/store:/plugins/store
    - ./plugins/daemon:/plugins/daemon
    - ./plugins/docker:/plugins/docker
    # SSH authorized_keys mount removed for Coolify compatibility (variable substitution not allowed)
    # - /root/.ssh/authorized_keys:${BITCART_SSH_AUTHORIZED_KEYS}
    - /var/lib/dbus/machine-id:/var/lib/dbus/machine-id
    - tor_servicesdir:/var/lib/tor/hidden_services
    - tor_torrcdir:/usr/local/etc/tor/
networks: {}
volumes:
  bitcoin_datadir: null
  bitcart_datadir: null
  backup_datadir:
    external: true
  dbdata: null
  nginx_conf: null
  nginx_vhost: null
  nginx_html: null
  nginx_certs: null
  acme: null
  tor_datadir: null
  tor_torrcdir: null
  tor_servicesdir: null

# NOTE: THIS FILE IS GENERATED VIA ./build.sh
# DO NOT EDIT THIS FILE DIRECTLY UNLESS REQUESTED
# Use BITCART_ADDITIONAL_COMPONENTS and set BITCARTGEN_DOCKER_IMAGE to bitcart/docker-compose-generator:local
# to load custom .yml components you add in generator/docker-components directory
services:
  admin:
    restart: unless-stopped
    image: bitcart/bitcart-admin:stable
    expose:
    - '4000'
    command: yarn start
    environment:
      BITCART_ADMIN_LOG_FILE: bitcart.log
      BITCART_ADMIN_API_URL: ${BITCART_ADMIN_API_URL}
      VIRTUAL_NETWORK: nginx-proxy
      VIRTUAL_PORT: 4000
      VIRTUAL_HOST: ${BITCART_ADMIN_HOST}
      VIRTUAL_HOST_NAME: bitcart-admin
      LETSENCRYPT_HOST: ${BITCART_ADMIN_HOST}
      LETSENCRYPT_EMAIL: ${BITCART_LETSENCRYPT_EMAIL}
      BITCART_ADMIN_ROOTPATH: ${BITCART_ADMIN_ROOTPATH:-/}
      BITCART_STORE_HOST: ${BITCART_STORE_HOST}
      BITCART_STORE_ROOTPATH: ${BITCART_STORE_ROOTPATH:-/}
    ports:
    - 4000:4000
    links:
    - backend
  backend:
    depends_on:
    - bitcoin
    - ergon
    - database
    - redis
    links:
    - bitcoin
    - ergon
    - database
    - redis
    restart: unless-stopped
    image: bitcart/bitcart:stable
    command: bash -c "alembic upgrade head && gunicorn -c gunicorn.conf.py \"main:configure_production_app()\""
    environment:
      BITCART_ENV: production
      LOG_FILE: bitcart.log
      BITCART_DATADIR: /datadir
      BITCART_BACKUPS_DIR: /backups
      BITCART_VOLUMES: /datadir /backups /plugins
      DB_PORT: 5432
      DB_HOST: database
      VIRTUAL_NETWORK: nginx-proxy
      VIRTUAL_PORT: 8000
      VIRTUAL_HOST: ${BITCART_HOST}
      VIRTUAL_HOST_NAME: bitcart-backend
      LETSENCRYPT_HOST: ${BITCART_HOST}
      LETSENCRYPT_EMAIL: ${BITCART_LETSENCRYPT_EMAIL}
      BITCART_CRYPTOS: ${BITCART_CRYPTOS:-btc}
      BTC_NETWORK: ${BTC_NETWORK:-mainnet}
      BTC_LIGHTNING: ${BTC_LIGHTNING:-false}
      BCH_NETWORK: ${BCH_NETWORK:-mainnet}
      ETH_NETWORK: ${ETH_NETWORK:-mainnet}
      BNB_NETWORK: ${BNB_NETWORK:-mainnet}
      MATIC_NETWORK: ${MATIC_NETWORK:-mainnet}
      TRX_NETWORK: ${TRX_NETWORK:-mainnet}
      XRG_NETWORK: ${XRG_NETWORK:-mainnet}
      LTC_NETWORK: ${LTC_NETWORK:-mainnet}
      LTC_LIGHTNING: ${LTC_LIGHTNING:-false}
      GRS_NETWORK: ${GRS_NETWORK:-mainnet}
      GRS_LIGHTNING: ${GRS_LIGHTNING:-false}
      XMR_NETWORK: ${XMR_NETWORK:-mainnet}
      UPDATE_URL: ${BITCART_UPDATE_URL:-https://api.bitcart.ai/updates/latest}
      BITCART_BACKEND_ROOTPATH: ${BITCART_BACKEND_ROOTPATH:-}
      SSH_CONNECTION: root@host.docker.internal:22
      SSH_KEY_FILE: ${BITCART_SSH_KEY_FILE}
      SSH_AUTHORIZED_KEYS: ${BITCART_SSH_AUTHORIZED_KEYS}
      BASH_PROFILE_SCRIPT: ${BASH_PROFILE_SCRIPT}
      BITCART_BACKEND_PLUGINS_DIR: /plugins/backend
      BITCART_ADMIN_PLUGINS_DIR: /plugins/admin
      BITCART_STORE_PLUGINS_DIR: /plugins/store
      BITCART_DAEMON_PLUGINS_DIR: /plugins/daemon
      BITCART_DOCKER_PLUGINS_DIR: /plugins/docker
      BITCART_HOST: ${BITCART_HOST}
      BITCART_ADMIN_HOST: ${BITCART_ADMIN_HOST}
      BITCART_ADMIN_ROOTPATH: ${BITCART_ADMIN_ROOTPATH:-/}
      BITCART_REVERSEPROXY: ${BITCART_REVERSEPROXY:-nginx-https}
      BITCART_HTTPS_ENABLED: ${BITCART_HTTPS_ENABLED:-false}
      SENTRY_DSN: ${BITCART_SENTRY_DSN:-}
      BITCART_API_WORKERS: ${BITCART_API_WORKERS}
      BITCART_PROMETHEUS_METRICS_ENABLED: ${BITCART_PROMETHEUS_METRICS_ENABLED:-false}
    extra_hosts:
    - host.docker.internal:host-gateway
    expose:
    - '8000'
    volumes:
    - bitcart_datadir:/datadir
    - backup_datadir:/backups
    - ./plugins/backend:/plugins/backend
    - ./plugins/admin:/plugins/admin
    - ./plugins/store:/plugins/store
    - ./plugins/daemon:/plugins/daemon
    - ./plugins/docker:/plugins/docker
    ports:
    - 8000:8000
  bitcoin:
    restart: unless-stopped
    image: bitcart/bitcart-btc:stable
    environment:
      BTC_NETWORK: ${BTC_NETWORK:-mainnet}
      BTC_LIGHTNING: ${BTC_LIGHTNING:-false}
      BTC_LIGHTNING_GOSSIP: ${BTC_LIGHTNING_GOSSIP:-false}
      BTC_DEBUG: ${BTC_DEBUG:-false}
    expose:
    - '5000'
    volumes:
    - bitcoin_datadir:/data
  database:
    restart: unless-stopped
    image: pgautoupgrade/pgautoupgrade:17-alpine
    command:
    - -c
    - random_page_cost=1.0
    environment:
      POSTGRES_USER: postgres
      POSTGRES_DB: bitcart
      POSTGRES_HOST_AUTH_METHOD: trust
    volumes:
    - dbdata:/var/lib/postgresql/data
    expose:
    - '5432'
  ergon:
    restart: unless-stopped
    image: bitcart/bitcart-xrg:stable
    environment:
      XRG_NETWORK: ${XRG_NETWORK:-mainnet}
      XRG_DEBUG: ${XRG_DEBUG:-false}
    expose:
    - '5005'
    volumes:
    - ergon_datadir:/data
  redis:
    restart: unless-stopped
    image: redis:alpine
    expose:
    - '6379'
  store:
    restart: unless-stopped
    image: bitcart/bitcart-store:stable
    expose:
    - '3000'
    command: yarn start
    environment:
      BITCART_STORE_API_URL: ${BITCART_STORE_API_URL}
      VIRTUAL_NETWORK: nginx-proxy
      VIRTUAL_PORT: 3000
      VIRTUAL_HOST: ${BITCART_STORE_HOST}
      VIRTUAL_HOST_NAME: bitcart-store
      LETSENCRYPT_HOST: ${BITCART_STORE_HOST}
      LETSENCRYPT_EMAIL: ${BITCART_LETSENCRYPT_EMAIL}
      BITCART_STORE_ROOTPATH: ${BITCART_STORE_ROOTPATH:-/}
      BITCART_ADMIN_HOST: ${BITCART_ADMIN_HOST}
      BITCART_ADMIN_ROOTPATH: ${BITCART_ADMIN_ROOTPATH:-/}
    ports:
    - 3000:3000
    links:
    - backend
  worker:
    depends_on:
    - backend
    links:
    - backend
    restart: unless-stopped
    image: bitcart/bitcart:stable
    command: python3 worker.py
    environment:
      BITCART_ENV: production
      LOG_FILE: bitcart.log
      BITCART_DATADIR: /datadir
      BITCART_BACKUPS_DIR: /backups
      BITCART_VOLUMES: /datadir /backups /plugins
      BITCART_CRYPTOS: ${BITCART_CRYPTOS:-btc}
      BTC_NETWORK: ${BTC_NETWORK:-mainnet}
      BTC_LIGHTNING: ${BTC_LIGHTNING:-false}
      BCH_NETWORK: ${BCH_NETWORK:-mainnet}
      ETH_NETWORK: ${ETH_NETWORK:-mainnet}
      BNB_NETWORK: ${BNB_NETWORK:-mainnet}
      MATIC_NETWORK: ${MATIC_NETWORK:-mainnet}
      TRX_NETWORK: ${TRX_NETWORK:-mainnet}
      XRG_NETWORK: ${XRG_NETWORK:-mainnet}
      LTC_NETWORK: ${LTC_NETWORK:-mainnet}
      LTC_LIGHTNING: ${LTC_LIGHTNING:-false}
      GRS_NETWORK: ${GRS_NETWORK:-mainnet}
      GRS_LIGHTNING: ${GRS_LIGHTNING:-false}
      XMR_NETWORK: ${XMR_NETWORK:-mainnet}
      UPDATE_URL: ${BITCART_UPDATE_URL:-https://api.bitcart.ai/updates/latest}
      SSH_CONNECTION: root@host.docker.internal:22
      SSH_KEY_FILE: ${BITCART_SSH_KEY_FILE}
      SSH_AUTHORIZED_KEYS: ${BITCART_SSH_AUTHORIZED_KEYS}
      BASH_PROFILE_SCRIPT: ${BASH_PROFILE_SCRIPT}
      BITCART_BACKEND_PLUGINS_DIR: /plugins/backend
      BITCART_ADMIN_PLUGINS_DIR: /plugins/admin
      BITCART_STORE_PLUGINS_DIR: /plugins/store
      BITCART_DAEMON_PLUGINS_DIR: /plugins/daemon
      BITCART_DOCKER_PLUGINS_DIR: /plugins/docker
      BITCART_HOST: ${BITCART_HOST}
      BITCART_ADMIN_HOST: ${BITCART_ADMIN_HOST}
      BITCART_ADMIN_ROOTPATH: ${BITCART_ADMIN_ROOTPATH:-/}
      BITCART_REVERSEPROXY: ${BITCART_REVERSEPROXY:-nginx-https}
      BITCART_HTTPS_ENABLED: ${BITCART_HTTPS_ENABLED:-false}
      SENTRY_DSN: ${BITCART_SENTRY_DSN:-}
      BITCART_PROMETHEUS_METRICS_ENABLED: ${BITCART_PROMETHEUS_METRICS_ENABLED:-false}
    extra_hosts:
    - host.docker.internal:host-gateway
    expose:
    - '9020'
    volumes:
    - bitcart_datadir:/datadir
    - backup_datadir:/backups
    - ./plugins/backend:/plugins/backend
    - ./plugins/admin:/plugins/admin
    - ./plugins/store:/plugins/store
    - ./plugins/daemon:/plugins/daemon
    - ./plugins/docker:/plugins/docker
    - /var/lib/dbus/machine-id:/var/lib/dbus/machine-id
networks: {}
volumes:
  bitcoin_datadir: null
  ergon_datadir: null
  bitcart_datadir: null
  backup_datadir:
    external: true
  dbdata: null
